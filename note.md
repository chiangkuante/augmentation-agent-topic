# augmentation-agent-topic 系統架構介紹

## 🎯 專案概述

本專案「augmentation-agent-topic」是一個創新的LLM輔助迭代式主題建模框架，專門設計用於分析企業報告並生成數位韌性評分。系統整合了先進的自然語言處理技術與大型語言模型的智慧分析能力，實現自動化的主題最佳化與韌性評估。

### 核心目標
- **自動化主題建模**：使用BERTopic進行初始主題建模
- **智慧最佳化**：透過LLM進行主題品質分析與迭代改進
- **韌性評分**：將最佳化後的主題映射至數位韌性框架，生成企業韌性評分

## 🏗️ 系統架構設計

### 整體架構圖

```
┌─────────────────────────────────────────────────────────────┐
│                    輸入資料層                                │
│  corpus_semantic_chunks.csv (企業報告語意區塊)              │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────────┐
│                資料處理層                                   │
│  - 資料載入與清理 (data_loader.py)                         │
│  - 編碼處理與驗證                                           │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────────┐
│                主題建模層                                   │
│  - ModernBERT 嵌入向量生成                                  │
│  - BERTopic 初始主題建模 (initial_topic_modeler.py)        │
│  - UMAP降維 + HDBSCAN聚類                                   │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────────┐
│              LLM智慧分析層                                  │
│  - OpenAI GPT-4/GPT-3.5 模型選擇                          │
│  - 主題品質評估 (llm_agent.py)                             │
│  - 最佳化指令生成 (MERGE/SPLIT)                             │
│  - 成本控制與預算管理                                       │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────────┐
│              迭代最佳化層                                   │
│  - 品質收斂判斷 (iterative_optimizer.py)                   │
│  - 主題合併/分割執行                                        │
│  - 多重品質指標追蹤                                         │
│  - 自動回滾機制                                             │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────────┐
│              韌性評分層                                     │
│  - 數位韌性框架映射 (resilience_mapper.py)                 │
│  - 吸收/適應/轉換能力評分                                   │
│  - 置信度評估                                               │
└─────────────────┬───────────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────────┐
│                輸出結果層                                   │
│  - 最終主題清單與關鍵詞                                     │
│  - 企業年度韌性評分                                         │
│  - 品質報告與成本分析                                       │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 核心模組架構

### 1. 資料載入模組 (`src/data_loader.py`)
**功能定位**：資料預處理與標準化
```python
load_corpus(file_path) → pandas.DataFrame
```
- **輸入**：CSV格式的企業報告語意區塊檔案
- **輸出**：標準化資料框架，包含 ['ticker', 'year', 'text'] 欄位
- **特色功能**：
  - 多編碼格式自動偵測與處理
  - 資料完整性驗證
  - 異常資料清理與記錄

### 2. 初始主題建模模組 (`src/initial_topic_modeler.py`)
**功能定位**：基礎主題發現與建模
```python
create_initial_topics(documents) → (BERTopic模型, 主題資料框架)
```
- **技術棧**：
  - **嵌入模型**：ModernBERT (answerdotai/ModernBERT-base/large)
  - **降維演算法**：UMAP (Uniform Manifold Approximation and Projection)
  - **聚類演算法**：HDBSCAN (Hierarchical Density-Based Spatial Clustering)
- **階段式實現**：
  - Phase 1：sentence-transformers/all-mpnet-base-v2 (穩定性優先)
  - Phase 2：ModernBERT自訂包裝器
  - Phase 3：直接transformers整合
- **效能最佳化**：
  - 批次嵌入計算
  - 記憶體效率管理
  - 檢查點機制

### 3. LLM智慧代理模組 (`src/llm_agent.py`)
**功能定位**：智慧主題分析與最佳化決策
```python
LLMAgent(api_key, model_name, temperature, max_retries)
```
- **核心方法**：
  - `get_topic_name_and_summary()` - 主題命名與摘要生成
  - `evaluate_topic_quality()` - 主題品質評估
  - `generate_optimization_commands()` - 最佳化指令生成
  - `calculate_tokens_and_cost()` - 成本估算與控制

- **LLM模型支援**：
  - OpenAI GPT-4 (高品質分析)
  - OpenAI GPT-3.5-turbo (成本效益平衡)
  - 本地LLM (Ollama + Llama-3.1-8B，成本控制)

- **智慧分析機制**：
  - **思維鏈推理 (Chain-of-Thought)**：結構化的邏輯推理過程
  - **批次處理**：減少70%的API呼叫次數
  - **品質評估**：一致性、獨特性、連貫性多維度分析

### 4. 迭代最佳化模組 (`src/iterative_optimizer.py`)
**功能定位**：智慧迭代與品質控制
```python
Optimizer(max_iterations=5, api_budget_limit=50, convergence_threshold=0.02)
```
- **最佳化策略**：
  - **Phase 1 (MVP)**：僅支援主題合併 (MERGE) 操作
  - **Phase 2**：新增主題分割 (SPLIT) 功能
  - **Phase 3**：階層式主題建模

- **品質控制機制**：
  - **多重收斂準則**：品質改善閾值、成本效益分析、平台期偵測
  - **自動回滾**：品質下降時自動回復到最佳狀態
  - **檢查點系統**：每次迭代後自動儲存中間結果

- **成本管理**：
  - 硬性預算限制 (預設$50)
  - 即時成本追蹤
  - 自動停止機制

### 5. 韌性映射模組 (`src/resilience_mapper.py`)
**功能定位**：數位韌性框架映射與評分

#### 數位韌性框架定義

**吸收能力 (Absorption Capacity)**
- **定義**：組織承受重大衝擊時維持核心結構與營運的能力
- **關鍵指標**：
  - 備援與替代方案 (備份系統、多元化供應鏈)
  - 預測與抵禦能力 (大數據風險預測、AI威脅偵測)
  - 營運穩定性維持 (遠距辦公、線上協作平台)

**適應能力 (Adaptive Capacity)**
- **定義**：主動調整結構、營運方式和策略以應對新環境的能力
- **關鍵指標**：
  - 流程與資源重新配置 (通路轉移、組織調整)
  - 數位化應變方案 (新數位服務、數位分身技術)
  - 市場與產品重新定位 (數據驅動產品調整、社群媒體行銷)

**轉換能力 (Transformation Capacity)**
- **定義**：進行深層次、根本性變革以適應全新環境的能力
- **關鍵指標**：
  - 商業模式根本性重設計 (訂閱制轉型、產品即服務)
  - 新興數位技術採用 (AI、區塊鏈、IoT智慧工廠)
  - 生態系與合作關係重建 (產業聯盟、新創合作)

**核心功能**：
```python
map_topics_to_resilience() → 主題韌性維度映射
calculate_resilience_scores() → 企業年度韌性評分
```

### 6. 主控制模組 (`src/main.py`)
**功能定位**：流程編排與系統整合
- **命令列介面**：
  - `--model` (模型選擇)
  - `--temperature` (輸出穩定性)
  - `--budget` (預算控制)
  - `--max-iterations` (最大迭代次數)
- **流程控制**：進度追蹤、錯誤處理、結果輸出

## 🎛️ 配置與管理系統

### 配置管理 (`config/`)
- **`settings.py`**：系統參數、模型配置、品質閾值
- **`prompts.py`**：所有LLM提示範本集中管理

### 日誌系統 (`logs/`)
- 執行日誌記錄
- 成本追蹤日誌
- 品質變化歷史
- 錯誤診斷資訊

### 實驗環境 (`notebooks/`)
- Jupyter筆記本用於模型實驗
- 參數調整與效果驗證
- 視覺化分析工具

## 📊 品質保證框架

### 數學驗證
- **一致性分數 (Coherence Score)**：主題內關鍵詞語意一致性
- **輪廓分析 (Silhouette Analysis)**：文件聚類品質評估
- **主題多樣性 (Topic Diversity)**：主題間區別度量測

### 人工驗證
- **專家評估**：領域專家對主題品質進行標註
- **交叉驗證**：K折交叉驗證確保結果穩定性
- **基準比較**：與傳統BERTopic方法效果對比

### 成功準則
- 主題一致性改善 >10% (相對於基準方法)
- 單次執行成本 <$50 (典型語料庫規模)
- 處理時間 <4小時 (10K文件)
- 人工評估者一致性 >0.7 (Kappa係數)

## 🚀 分階段實施策略

### Phase 1: 最小可行產品 (MVP) - 2-3週
**目標**：驗證核心概念並建立成本控制
- 使用穩定的sentence-transformers模型
- 僅實現主題合併功能
- 建立硬性預算限制 ($50)
- 最多5次迭代與早期停止機制

### Phase 2: 增強系統 - 3-4週
**目標**：新增進階功能與穩健性
- ModernBERT整合與自訂包裝器
- 主題分割功能實現
- 本地LLM支援 (成本降低)
- 進階品質評估機制

### Phase 3: 生產就緒 - 2-3週
**目標**：可擴展性與企業級功能
- 分散式處理支援 (大型語料庫)
- 即時監控與告警系統
- 進階錯誤恢復機制
- 全面驗證框架

## ⚡ 效能與資源需求

### 硬體需求
- **記憶體**：最小8GB RAM (大型語料庫建議16GB+)
- **GPU**：可選，用於ModernBERT推論加速
- **儲存**：5-10GB (模型與中間結果)

### 軟體環境
- **Python 3.10+** 與 mamba 套件管理
- **核心依賴**：bertopic, openai, transformers, sentence-transformers
- **版本鎖定**：確保環境可重現性

### 成本估算
- **API預算**：$50-100每次管道執行
- **本地運算**：可選的成本降低方案
- **時間複雜度**：O(n*k*i) n=文件數, k=主題數, i=迭代次數

## 🛡️ 風險緩解策略

### 高風險區域
1. **API成本爆炸**：硬性預算限制 + 本地LLM備援
2. **ModernBERT整合複雜性**：階段式實施 + 降級方案
3. **主題分割實現**：MVP專注合併 + 階層式方法
4. **品質評估有效性**：多重指標 + 人工校正

### 替代方案
- **靜態最佳化**：單次分析無迭代
- **人在迴路**：LLM建議 + 人工審核
- **基於規則**：純數學指標驅動

## 📈 監控與評估

### 即時監控
- **成本追蹤**：API使用量與預算消耗
- **品質變化**：迭代過程中品質指標變化
- **系統效能**：記憶體使用、處理時間

### 結果評估
- **企業韌性評分準確性**：與已知案例對比
- **主題品質提升程度**：量化改善效果
- **系統穩定性**：成功完成率 >95%

## 🔮 未來發展方向

### 技術擴展
- **多語言支援**：擴展至中文、其他語言企業報告
- **即時分析**：支援串流資料處理
- **深度整合**：與企業系統API整合

### 應用拓展
- **其他韌性框架**：氣候韌性、供應鏈韌性
- **行業客製化**：特定行業的韌性評估模型
- **政策分析**：政府政策文件分析應用

---

**系統設計特色**：
- ✅ **成本可控**：嚴格的預算管理與成本最佳化
- ✅ **品質保證**：多重驗證機制確保結果可靠性
- ✅ **階段實施**：風險可控的漸進式開發
- ✅ **技術先進**：結合最新LLM與NLP技術
- ✅ **實用導向**：專注於實際商業應用價值